# Deploy to Pivotal Cloud Foundry

## Docker

The first we need to do is to generate a docker image and push it to any registry.

We will use the [DockerHub](https://hub.docker.com) registry for the example. There is an script that build the image and push it. Nothing especial here.

Dockerfile extends from `maven` image. The build part of the image just install the dependencies and generates de package (jar file), the runtime of the Dockerfile runs the jar generated by the build.

## Pivotal CloudFoundry
Now that we have our images pushed to DockerHub, we can now focus on push them into Pivotal Platform.

The first requirement we have is to create an account in [Pivotal](https://pivotal.io/get-started).
When you get access to your console, you should create an organization manually. It's simple as fill an input inside *Create an Org*.

Next step is to install the CF CLI in our computer. You have a guide to do it in your platform in [PCF CLI Install](https://pivotal.io/platform/pcf-tutorials/getting-started-with-pivotal-cloud-foundry/install-the-cf-cli)

Once we have CF CLI installed in our machine, you can now login to your Pivotal account:

    $ cf login -a https://api.run.pivotal.io

Now you have connected your CF CLI with your account of Pivotal, you just need to go inside each service and run:

    $ cf push

Once we have both services deployed (`frontservice` and `backservice`) we need to do something more.

We need to create a policy to allow connections from `frontservice` to `backservice` using `tcp` protocol on port 8082 (the configured port inside `backservice`).
That is done running this command:

    $ cf add-network-policy frontservice --destination-app backservice --port 8082 --protocol tcp

## How does it work?

For each service we have created a `manifest.yml` with all the configuration needed to CF for deploy it correctly.

`Frontservice` knows about `backservice host`  from an environment variable set inside manifest.yml.
